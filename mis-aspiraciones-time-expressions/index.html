<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis aspiraciones: Voy a‚Ä¶</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/bwyD9j9w/Teacher-ed-Logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Lilita+One&display=swap" rel="stylesheet">
    <style>
        /* Base styles from template */
        body {
            font-family: 'Comic Neue', cursive;
            background-color: #eef2ff; /* Light indigo background */
            color: #1a202c;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .main-content-wrapper {
            flex-grow: 1;
        }
        .container {
            max-width: 90%;
            margin: 0 auto;
            padding: 1.5rem 0;
        }

        /* Header styles */
        .header {
            background-color: #fef3c7;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-height: 80px;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .header-logo {
            height: 50px;
            width: auto;
            border-radius: 0.5rem;
        }
        .header-title {
            font-family: 'Lilita One', cursive;
            color: #f97316;
            font-size: 1.5rem; /* Adjusted for mobile */
            font-weight: 400;
            text-align: center;
        }

        /* Footer styles */
        .footer {
            background-color: #ea580c;
            color: white;
            padding: 1.25rem 2rem;
            text-align: center;
            margin-top: auto;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }

        /* Card (lesson-section) styles */
        .lesson-section {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            border-left-width: 4px;
            border-bottom-width: 4px;
            border-color: transparent;
        }
        .lesson-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .section-header {
            padding: 0.75rem 1.5rem;
            font-size: 1.5rem;
            font-family: 'Lilita One', cursive;
            font-weight: 400;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .section-content {
            padding: 1.5rem;
        }

        /* Card Header/Border Colors */
        .header-main { background-color: #3b82f6; } /* Blue */
        .header-activity { background-color: #8b5cf6; } /* Violet/Purple */
        .header-vocab { background-color: #f59e0b; } /* Amber/Yellow */
        .header-quiz { background-color: #f97316; } /* Orange */

        /* New styles from Math lesson for video */
        .header-video { background-color: #dc2626; } /* Red */
        .border-video { border-color: #dc2626; }
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .video-container iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .video-wrapper {
            transition: max-width 0.5s ease-in-out;
            margin: 0 auto;
        }
        .video-wrapper.collapsed {
            max-width: 60%; /* Making the video smaller */
        }
        .video-wrapper.expanded {
            max-width: 100%;
        }
        /* End of new styles */

        .border-main { border-color: #3b82f6; }
        .border-activity { border-color: #8b5cf6; }
        .border-vocab { border-color: #f59e0b; }
        .border-quiz { border-color: #f97316; }

        /* General text styles */
        p { margin-bottom: 1rem; line-height: 1.6; font-size: 1.1rem; }
        ul { margin-top: 1em; margin-bottom: 1em; padding-left: 1.5rem; list-style-type: disc; }
        li { margin-top: 0.5em; margin-bottom: 0.5em; font-size: 1.1rem; }
        strong { font-weight: 700; }

        /* Button styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            border: none;
            margin-top: 1rem;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        .btn:active { transform: translateY(0); box-shadow: none; }
        .button-primary { background-color: #4f46e5; }
        .button-primary:hover { background-color: #4338ca; }
        .button-secondary { background-color: #6b7280; margin-left: 0.5rem; }
        .button-secondary:hover { background-color: #4b5563; }

        /* Quiz Option styles */
        .quiz-option {
            background-color: #f0f9ff; border: 2px solid #93c5fd; padding: 0.75rem 1rem;
            margin-bottom: 0.5rem; border-radius: 0.5rem; cursor: pointer;
            transition: all 0.2s ease;
        }
        .quiz-option:hover { background-color: #e0f2fe; transform: translateX(5px); }
        .quiz-option.selected { background-color: #bfdbfe; border-color: #2563eb; }
        .quiz-option.correct-answer { background-color: #d1fae5; border-color: #10b981; animation: flashGreen 0.5s ease-out; }
        .quiz-option.incorrect-answer { background-color: #fee2e2; border-color: #ef4444; animation: shake 0.5s ease-out, flashRed 0.5s ease-out; }

        /* Quick Check Answer Box styles */
        .answer-box {
            background-color: #ecfdf5; border: 1px solid #34d399; padding: 1rem;
            border-radius: 0.5rem; margin-top: 1rem; display: none;
            animation: flashGreen 0.5s ease-out;
        }

        /* Visual Feedback Animations */
        @keyframes flashGreen { 0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); } 50% { box-shadow: 0 0 15px 5px rgba(16, 185, 129, 0.7); } 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); } }
        @keyframes flashRed { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 50% { box-shadow: 0 0 15px 5px rgba(239, 68, 68, 0.7); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25%, 75% { transform: translateX(-5px); } 50% { transform: translateX(5px); } }

        /* Confetti styles */
        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        .confetti { position: absolute; width: 10px; height: 10px; opacity: 0; animation: confetti-fall 3s forwards; }
        @keyframes confetti-fall { 0% { opacity: 1; transform: translateY(-100vh) rotate(0deg); } 100% { opacity: 0; transform: translateY(100vh) rotate(720deg); } }

        /* Feedback message styles */
        .feedback { margin-top: 1rem; font-weight: 600; opacity: 0; transform: scale(0.95); transition: opacity 0.5s ease-out, transform 0.5s ease-out; }
        .feedback.show { opacity: 1; transform: scale(1); }
        .correct-feedback { color: #10b981; }
        .incorrect-feedback { color: #ef4444; }

        /* Drag & Drop styles */
        .draggable {
            background-color: #a78bfa; color: white; padding: 0.75rem 1.25rem; margin: 0.5rem;
            border-radius: 0.5rem; cursor: grab; flex: 1 1 auto; max-width: calc(50% - 1rem);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); transition: all 0.2s ease-in-out;
            display: flex; align-items: center; justify-content: center; text-align: center;
            min-height: 50px;
        }
        .draggable:active { cursor: grabbing; transform: scale(1.05); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); z-index: 10; }
        .dropzone {
            padding: 1rem; border: 2px dashed #a5b4fc; background-color: #f0f9ff;
            border-radius: 0.75rem; min-height: 100px; transition: all 0.3s ease;
            display: flex; flex-direction: column; align-items: center;
        }
        .dropzone.hover { background-color: #e0e7ff; border-color: #6366f1; }
        .dropzone.correct { border-style: solid; border-color: #10b981; background-color: #d1fae5; animation: flashGreen 0.5s ease-out; }
        .dropzone.incorrect { border-style: solid; border-color: #ef4444; background-color: #fee2e2; animation: shake 0.5s ease-out, flashRed 0.5s ease-out; }
        .dropzone-label { font-weight: 700; color: #4338ca; margin-bottom: 0.5rem; }
        @media (max-width: 640px) { .draggable { max-width: calc(100% - 1rem); } }

        /* Memory Game styles */
        .memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; max-width: 600px; margin: 1.5rem auto; }
        .memory-card { background-color: #a78bfa; border-radius: 0.5rem; height: 100px; cursor: pointer; position: relative; transform-style: preserve-3d; transition: transform 0.5s; display: flex; align-items: center; justify-content: center; text-align: center; padding: 0.5rem; }
        .memory-card .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; }
        .card-face.front { background-color: #8b5cf6; }
        .card-face.back { background-color: #ede9fe; color: #5b21b6; transform: rotateY(180deg); }
        .memory-card.is-flipped { transform: rotateY(180deg); }
        .memory-card.is-matched { transform: rotateY(180deg); background-color: #d1fae5 !important; border: 2px solid #10b981; cursor: default; }
        .memory-card.is-matched .card-face.back { color: #065f46; }
        @media (max-width: 640px) { .memory-grid { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; } .memory-card { height: 120px; } }

        /* Fill-in-the-blank styles */
        .cloze-select {
            border: 2px dashed #93c5fd; background-color: #f0f9ff; border-radius: 0.375rem;
            padding: 0.25rem 0.5rem; margin: 0 0.25rem;
            font-weight: bold; color: #2563eb; transition: all 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em;
            padding-right: 2.5rem;
        }
        .cloze-select:focus { outline: none; border-style: solid; background-color: #e0f2fe; }
    </style>
    <script>
        // TailwindCSS responsive configuration
        tailwind.config = {
          theme: {
            extend: {
              screens: { 'xs': '475px' }
            }
          }
        }
      </script>
</head>
<body>

    <header class="header">
        <div class="header-left">
            <img src="https://i.postimg.cc/bwyD9j9w/Teacher-ed-Logo.png" alt="Teacher Ed Logo" class="header-logo">
            <div class="header-title sm:text-2xl">Teacher Ed Classroom</div>
        </div>
    </header>

    <div class="main-content-wrapper">
        <div class="container">

            <!-- 1. Main Title Card -->
            <div class="lesson-section border-main">
                <div class="section-header header-main">
                    <span>Mis aspiraciones: Planes para el futuro üöÄ</span>
                </div>
                <div class="section-content">
                    <p>¬°Hola! üëã Esta semana vamos a expandir lo que sabes sobre <strong>ir + a + infinitivo</strong>. Aprender√°s a a√±adir <strong>expresiones de tiempo</strong> para decir <em>cu√°ndo</em> har√°s tus planes. ¬°Esto har√° que tus aspiraciones sean m√°s claras y emocionantes!</p>
                </div>
            </div>

            <!-- 2. Mini-Explainer Card -->
            <div class="lesson-section border-main">
                <div class="section-header header-main">
                    <span>¬øC√≥mo se dice el futuro? ü§î</span>
                </div>
                <div class="section-content">
                    <p>Ya conoces la f√≥rmula b√°sica para hablar del futuro. ¬°Ahora vamos a a√±adirle m√°s detalle!</p>
                    <ul>
                        <li><strong>La F√≥rmula:</strong> Sujeto + <strong>ir</strong> (conjugado) + <strong>a</strong> + <strong>verbo en infinitivo</strong> + <strong>expresi√≥n de tiempo</strong>.</li>
                        <li><strong>Ejemplo:</strong> <em>Yo</em> <strong>voy a estudiar</strong> <em>ma√±ana</em>.</li>
                        <li><strong>Ejemplo:</strong> <em>Nosotros</em> <strong>vamos a viajar</strong> <em>el pr√≥ximo a√±o</em>.</li>
                    </ul>
                    <p class="text-sm text-gray-600 mt-4">üí° <strong>Tip:</strong> ¬°Las expresiones de tiempo nos dicen cu√°ndo suceder√° la acci√≥n!</p>
                </div>
            </div>

            <!-- NEW: Vocabulary Section -->
            <div class="lesson-section border-vocab">
                <div class="section-header header-vocab">
                    <span>Vocabulario: Verbos y Tiempo üìö</span>
                </div>
                <div class="section-content">
                    <p>Usa estos verbos para formar tus oraciones con <strong>"voy a..."</strong>. (Use these verbs to form your sentences with "I am going to...").</p>
                    <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-8 gap-y-2 mt-4">
                        <ul>
                            <li><strong>aprender</strong> - to learn</li>
                            <li><strong>beber</strong> - to drink</li>
                            <li><strong>caminar</strong> - to walk</li>
                            <li><strong>cantar</strong> - to sing</li>
                            <li><strong>comer</strong> - to eat</li>
                            <li><strong>comprar</strong> - to buy</li>
                            <li><strong>correr</strong> - to run</li>
                            <li><strong>dibujar</strong> - to draw</li>
                            <li><strong>dormir</strong> - to sleep</li>
                            <li><strong>escribir</strong> - to write</li>
                        </ul>
                        <ul>
                            <li><strong>escuchar</strong> - to listen</li>
                            <li><strong>estudiar</strong> - to study</li>
                            <li><strong>hablar</strong> - to speak</li>
                            <li><strong>hacer</strong> - to do/make</li>
                            <li><strong>ir</strong> - to go</li>
                            <li><strong>jugar</strong> - to play</li>
                            <li><strong>leer</strong> - to read</li>
                            <li><strong>mirar</strong> - to watch</li>
                            <li><strong>trabajar</strong> - to work</li>
                            <li><strong>viajar</strong> - to travel</li>
                        </ul>
                    </div>
                    <hr class="my-6 border-t-2 border-gray-200">
                    <p>¬°Y ahora, las <strong>expresiones de tiempo</strong>! (And now, the time expressions!)</p>
                    <ul class="list-disc pl-5 mt-4 grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 gap-x-8">
                        <li><strong>ma√±ana</strong> - tomorrow</li>
                        <li><strong>pasado ma√±ana</strong> - the day after tomorrow</li>
                        <li><strong>esta tarde</strong> - this afternoon</li>
                        <li><strong>esta noche</strong> - tonight</li>
                        <li><strong>el fin de semana</strong> - this weekend</li>
                        <li><strong>la semana que viene</strong> - next week</li>
                        <li><strong>el pr√≥ximo mes</strong> - next month</li>
                        <li><strong>el pr√≥ximo a√±o</strong> - next year</li>
                        <li><strong>en el futuro</strong> - in the future</li>
                        <li><strong>despu√©s de la graduaci√≥n</strong> - after graduation</li>
                        <li><strong>m√°s tarde</strong> - later</li>
                        <li><strong>pronto</strong> - soon</li>
                    </ul>
                </div>
            </div>

            <!-- NEW: Video Explainer -->
            <div class="lesson-section border-video">
                <div class="section-header header-video">
                    <span>Ver: La F√≥rmula del Futuro üé¨</span>
                </div>
                <div class="section-content">
                    <p>Mira este video para ver diferentes maneras de usar la estructura <strong>ir + a + infinitivo</strong>. Incluye ejemplos afirmativos, negativos, preguntas y expresiones de tiempo. (Watch this video to see different ways to use the structure. It includes affirmative, negative, and interrogative examples, along with time expressions.)</p>
                    <div class="video-wrapper collapsed">
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/yhZMruehpJU?playsinline=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. Quick Check #1 -->
            <div class="lesson-section border-vocab">
                <div class="section-header header-vocab">
                    <span>¬°Prueba R√°pida!</span>
                </div>
                <div class="section-content text-center">
                    <p>¬øC√≥mo se dice "next year" en espa√±ol?</p>
                    <button class="btn button-primary" onclick="toggleAnswer('qc1-answer')">Mostrar respuesta</button>
                    <div id="qc1-answer" class="answer-box">
                        <p class="text-lg font-bold">el pr√≥ximo a√±o ‚úÖ</p>
                    </div>
                </div>
            </div>

            <!-- 4. NEW: Memory Game -->
            <div class="lesson-section border-activity">
                <div class="section-header header-activity">
                    <span>Juego de Memoria: ¬°Conecta el Plan!</span>
                </div>
                <div class="section-content text-center">
                    <p>¬°Vamos a jugar! Encuentra los pares que forman una oraci√≥n completa. Haz clic en una tarjeta para voltearla.</p>
                    <div id="memory-game-grid" class="memory-grid">
                        <!-- Memory cards will be inserted here by JavaScript -->
                    </div>
                    <div>
                        <button class="btn button-secondary" onclick="initializeMemoryGame()">Reiniciar Juego</button>
                    </div>
                    <div id="memory-feedback" class="feedback text-lg"></div>
                </div>
            </div>

            <!-- 5. NEW: Fill-in-the-blank Activity -->
            <div class="lesson-section border-quiz">
                <div class="section-header header-quiz">
                    <span>Actividad: Completa el P√°rrafo ‚úçÔ∏è</span>
                </div>
                <div class="section-content">
                    <p class="text-center">¬°Demuestra lo que aprendiste! Lee el p√°rrafo y elige la opci√≥n correcta en cada men√∫ para completarlo.</p>
                    <div id="cloze-passage-container" class="space-y-4 max-w-3xl mx-auto mt-6 text-lg bg-gray-50 p-4 sm:p-6 rounded-lg">
                        <p>
                            ¬°Hola! Yo soy Alex. Ma√±ana, yo 
                            <select id="cloze-1" class="cloze-select" data-answer="voy">
                                <option value="">--</option><option value="voy">voy</option><option value="vas">vas</option><option value="van">van</option>
                            </select> 
                            a visitar a mis abuelos. Mi hermana Ana tambi√©n viene. Ella 
                            <select id="cloze-2" class="cloze-select" data-answer="va">
                                <option value="">--</option><option value="va">va</option><option value="vamos">vamos</option><option value="voy">voy</option>
                            </select> 
                            a llevar su libro favorito para leerlo esta tarde. ¬øY t√∫? ¬øQu√© 
                            <select id="cloze-3" class="cloze-select" data-answer="vas">
                                <option value="">--</option><option value="vas">vas</option><option value="va">va</option><option value="van">van</option>
                            </select> 
                            a hacer el fin de semana? Mis amigos y yo 
                            <select id="cloze-4" class="cloze-select" data-answer="vamos">
                                <option value="">--</option><option value="van">van</option><option value="vamos">vamos</option><option value="voy">voy</option>
                            </select> 
                            a jugar f√∫tbol en el parque. ¬°Pienso que todos 
                            <select id="cloze-5" class="cloze-select" data-answer="van">
                                <option value="">--</option><option value="vas">vas</option><option value="va">va</option><option value="van">van</option>
                            </select> 
                            a divertirse mucho!
                        </p>
                    </div>
                    <div class="text-center">
                        <button class="btn button-primary" onclick="checkClozePassage()">Revisar mis respuestas</button>
                        <div id="cloze-feedback" class="feedback text-lg"></div>
                    </div>
                </div>
            </div>

            <!-- 7. Write Your Plans (Reflection) -->
            <div class="lesson-section border-quiz">
                <div class="section-header header-quiz">
                    <span>¬°Tus Aspiraciones! ‚úçÔ∏è</span>
                </div>
                <form id="reflection-form" action="https://formspree.io/f/mldwqvwa" method="POST">
                    <div class="section-content text-center">
                        <p>¬°Es tu turno! Escribe 3‚Äì5 oraciones sobre tus planes y aspiraciones. Usa <strong>ir a + infinitivo</strong> y diferentes <strong>expresiones de tiempo</strong>.</p>
                        <input type="text" name="nombre" class="w-full p-3 mb-4 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition" placeholder="Escribe tu nombre aqu√≠..." required>
                        <textarea id="reflection-text" name="aspiraciones" rows="5" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition" placeholder="Por ejemplo: El pr√≥ximo a√±o, voy a ir a un nuevo colegio. Despu√©s de la graduaci√≥n, espero estudiar para ser doctor..." required minlength="40"></textarea>
                        <button type="submit" class="btn button-primary">Enviar a maestro</button>
                        <div id="reflection-feedback" class="feedback text-lg"></div>
                    </div>
                </form>
            </div>

            <!-- 8. Exit Ticket -->
            <div class="lesson-section border-main">
                <div class="section-header header-main">
                    <span>¬°Para Terminar! üéâ</span>
                </div>
                <div class="section-content text-center">
                    <p class="text-xl font-bold">En voz alta: di <strong>una</strong> oraci√≥n con ‚Äòvoy a‚Ä¶‚Äô y una expresi√≥n de tiempo.</p>
                    <p class="mt-4 text-lg">¬°Excelente! Ya puedes hablar del futuro en espa√±ol. ¬°Buen trabajo!</p>
                </div>
            </div>

        </div>
    </div>

    <footer class="footer">
        <p class="font-semibold">¬°Sigue aprendiendo y so√±ando en grande!</p>
        <p class="text-xs mt-1">¬© 2025 Teacher Ed Classroom ‚Äî All rights reserved.</p>
    </footer>

    <script>
        // --- Quick Check ---
        function toggleAnswer(id) {
            const answerBox = document.getElementById(id);
            answerBox.style.display = answerBox.style.display === 'block' ? 'none' : 'block';
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeMemoryGame();
        });

        // --- NEW: Memory Game ---
        const memoryCardsData = [
            { id: 1, content: 'Yo voy...' },
            { id: 1, content: '...a ser doctor.' },
            { id: 2, content: 'T√∫ vas...' },
            { id: 2, content: '...a viajar pronto.' },
            { id: 3, content: 'Ella va...' },
            { id: 3, content: '...a estudiar m√°s tarde.' },
            { id: 4, content: 'Nosotros vamos...' },
            { id: 4, content: '...a jugar el fin de semana.' },
        ];
        let flippedCards = [];
        let matchedPairs = 0;
        let lockBoard = false;

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function initializeMemoryGame() {
            const gameGrid = document.getElementById('memory-game-grid');
            gameGrid.innerHTML = '';
            document.getElementById('memory-feedback').classList.remove('show');
            flippedCards = [];
            matchedPairs = 0;
            lockBoard = false;

            const shuffledCards = shuffle([...memoryCardsData]);

            shuffledCards.forEach(cardData => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('memory-card');
                cardElement.dataset.id = cardData.id;

                cardElement.innerHTML = `
                    <div class="card-face front"></div>
                    <div class="card-face back">${cardData.content}</div>
                `;

                cardElement.addEventListener('click', flipCard);
                gameGrid.appendChild(cardElement);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === flippedCards[0]) return;

            this.classList.add('is-flipped');

            if (flippedCards.length === 0) {
                flippedCards.push(this);
                return;
            }

            flippedCards.push(this);
            checkForMatch();
        }

        function checkForMatch() {
            const [cardOne, cardTwo] = flippedCards;
            const isMatch = cardOne.dataset.id === cardTwo.dataset.id;

            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            const [cardOne, cardTwo] = flippedCards;
            cardOne.removeEventListener('click', flipCard);
            cardTwo.removeEventListener('click', flipCard);
            cardOne.classList.add('is-matched'); // This might be overridden by background-color on the element itself
            cardTwo.classList.add('is-matched');

            matchedPairs++;
            resetBoard();

            if (matchedPairs === memoryCardsData.length / 2) {
                const feedbackDiv = document.getElementById('memory-feedback');
                feedbackDiv.className = 'feedback text-lg correct-feedback show';
                feedbackDiv.textContent = '¬°Felicidades! ¬°Encontraste todos los pares! ü•≥';
                createConfetti();
            }
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                flippedCards.forEach(card => card.classList.remove('is-flipped'));
                resetBoard();
            }, 1200);
        }

        function resetBoard() {
            [flippedCards, lockBoard] = [[], false];
        }

        // --- NEW: Fill-in-the-blank Activity ---
        function checkClozePassage() {
            const selects = document.querySelectorAll('.cloze-select');
            let allCorrect = true;
            selects.forEach(select => {
                const userAnswer = select.value;
                const correctAnswer = select.dataset.answer;
                select.style.borderColor = '#93c5fd'; // Reset border color

                if (userAnswer === correctAnswer) {
                    select.style.borderColor = '#10b981'; // Green for correct
                } else {
                    select.style.borderColor = '#ef4444'; // Red for incorrect
                    allCorrect = false;
                }
            });

            const feedbackDiv = document.getElementById('cloze-feedback');
            if (allCorrect) {
                feedbackDiv.className = 'feedback text-lg correct-feedback show';
                feedbackDiv.textContent = '¬°Excelente! Completaste el p√°rrafo correctamente.';
            } else {
                feedbackDiv.className = 'feedback text-lg incorrect-feedback show';
                feedbackDiv.textContent = '¬°Casi! Revisa las respuestas en rojo e int√©ntalo de nuevo.';
            }
        }

        function createConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);
            for (let i = 0; i < 80; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                const colors = ['#3b82f6', '#f59e0b', '#8b5cf6', '#10b981', '#ef4444'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confettiContainer.appendChild(confetti);
            }
            setTimeout(() => confettiContainer.remove(), 5000);
        }

        // --- Reflection Textarea ---
        function submitReflection() {
            // This function is now handled by Formspree, but we can add client-side feedback.
            const form = document.getElementById('reflection-form');
            const nameInput = form.querySelector('input[name="nombre"]');
            const textarea = form.querySelector('textarea[name="aspiraciones"]');
            const feedbackDiv = document.getElementById('reflection-feedback');

            if (nameInput.value.trim() === '' || textarea.value.trim().length < 40) {
                feedbackDiv.className = 'feedback text-lg incorrect-feedback show';
                feedbackDiv.textContent = '¬°No te olvides de poner tu nombre y escribir tus planes!';
                return false; // Prevent submission
            } else {
                feedbackDiv.className = 'feedback text-lg correct-feedback show';
                feedbackDiv.textContent = '¬°Enviando tus planes... Gracias por compartir! üëç';
                return true; // Allow submission
            }
        }

        // Add an event listener to the form for a better user experience
        document.addEventListener('DOMContentLoaded', () => {
            initializeMemoryGame();
            const form = document.getElementById('reflection-form');
            if(form) {
                form.addEventListener('submit', function(e) {
                    if (!submitReflection()) {
                        e.preventDefault(); // Stop the form from submitting if validation fails
                    }
                });
            }
        });

    </script>
</body>
</html>
